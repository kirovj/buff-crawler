<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <script src="static/echarts.js"></script>
    <style>
        #main {
            margin: auto;
        }
    </style>
</head>

<body>
    <div id="main" style="width: 600px;height:400px;"></div>

    <script type="text/javascript">
        // 基于准备好的dom，初始化echarts实例
        var chart = echarts.init(document.getElementById('main'));

        window.fetch("/find_price", {
            method: 'post',
            body: JSON.stringify({
                'target': 'buff',
                'name': '蝴蝶刀',
                'item_id': 1220
            }),
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            }
        }).then(response => {
            if (response.ok) {
                return response.json();
            }
        }).then(result => {
            console.log(result);
            var date_list = []
            var price_list = []
            result['data'].forEach(data => {
                date_list.push(data['date']);
                price_list.push(data['price']);
            });

            // 计算数据最大值和最小值
            let minValue = 0
            let maxValue = 0
            let precision = 1 //精度
            maxValue = Math.ceil(Math.max.apply(null, price_list) / 10) * 10;
            minValue = Math.floor(Math.min.apply(null, price_list) / 10) * 10;
            // 计算间隔，返回y轴最大值，y轴最小值 ，间隔
            let getLeftData = (min, max) => {
                // 控制分隔条数，
                let diff = Math.ceil((max - min) / 3)
                return {
                    max: max + diff,
                    min: min - diff,
                    // 分割成 10 等份 
                    interval: Math.ceil((max + diff - (min - diff)) / 10),
                };
            }
            let interObj = getLeftData(minValue, maxValue)
            var option = {
                animationDuration: 500,
                title: {
                    text: 'CSGO ITEM PRICE'
                },
                tooltip: {},
                legend: {
                    data: ['price']
                },
                xAxis: {
                    data: date_list
                },
                yAxis: {
                    // 设置y轴间隔
                    interval: interObj.interval,
                    // 设置y轴最大值
                    min: interObj.min,
                    // 设置y轴最小值
                    max: interObj.max,
                    axisLabel: {
                        interval: 'auto',
                        formatter: function (value, index) {
                            return value;
                        }
                    },
                },
                series: [
                    {
                        name: 'price',
                        type: 'line',
                        smooth: true,
                        data: price_list
                    }
                ]
            };
            chart.setOption(option);
        }).catch(error => {
            console.log(error);
        });
    </script>
</body>

</html>